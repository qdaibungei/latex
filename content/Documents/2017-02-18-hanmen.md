---
layout: post
title: hanmenパッケージ
aliases:
    - /documents/2017/02/18/hanmen/
date: 2017-02-18
tags: ["LaTeX", "LaTeXパッケージ"]
---


# はじめに
hanmenパッケージというLaTeXパッケージを作った。[ダウンロードはここからできる](https://gist.github.com/qdaibungei/5f6986fa99fc9a7d86122a7a9417d64e)。

hanmenパッケージとは、版面の設計[^1]を厳密に行うためのパッケージである。たとえば、38字×40行で文書を作りたい、といったときにhanmenパッケージは有用である。

[^1]: 「版面の設計」とは何かについては、詳しくは「[基本版面（レイアウト）の設計](http://t2publisher.xrea.jp/forme/layout.shtml)」（外部サイト）などを参照せよ。

従来、LaTeXでは版面の設計が煩雑であった[^3]。とくに縦組みの場合、geometryパッケージが使えないので厄介である。そこで、縦組みでも版面設計がやりやすいようにと作ったのがhanmenパッケージである。

[^3]: 煩雑と言っても、原理を理解するのはそれほど難しいことではない。[ここ](http://d.hatena.ne.jp/Rion778/20091002/1254482262)に書いてあるように設定すればよいだけではある。ただし記述量が多く、プリアンブルに気軽に置いておける感じではない。そこでパッケージ化する必要が出てくるわけである。

基本的なアイディアはTomOne氏の『[よくわかるLaTeX小説](http://p-act.sakura.ne.jp/PARALLEL_ACT/LaTeX-Dojin/)』による。

なお、2017年2月18日現在、あべのり氏によって開発中のクラスファイルである[jlreq.cls](https://github.com/abenori/jlreq)は、従来のクラスファイルより圧倒的に版面設計が行いやすいようになっているようなので、jlreq.clsの安定版がリリースされたあかつきには、hanmenパッケージの存在意義は薄れゆくであろうと思われる。


# 使い方
## 基本
基本的な使い方は簡単である。プリアンブルに次のように書き込む。

```LaTeX
\usepackage[Q=15,H=24,W=38,L=40]{hanmen}
```

そうすると、

* 文字サイズ　15級
* 行送り　　　24歯
* 行長　　　　38字
* 行数　　　　40行

に設定できる。`Q` は文字サイズの単位「級」に、`H` は行送りの単位「歯」に、`W` はwidthに、`L` はlinesに由来している。

## 各種オプション
グリッド線を表示させる（`g`に代入する値は上の`W`で指定した文字数と同じか、または近い整数値を入れる）。

```LaTeX
\usepackage[g=38]{hanmen}
```

　

縦組みにする。

```LaTeX
\usepackage[tate]{hanmen}
```

　

ヘッダ・フッタの位置の調整。

```LaTeX
\usepackage[headheight=13mm, headsep=1mm, footskip=3mm]{hanmen}
```

　

デフォルトでは、版面は左右中央に配置される。これを、少しだけ小口側に寄せたり、天側に寄せたりしたい場合、以下のようにする。

```LaTeX
\usepackage[ko=3truemm]{hanmen}%% 3mm小口寄せ
```

```LaTeX
\usepackage[te=4truemm]{hanmen}%% 4mm天寄せ
```

　

ノド、小口、天、地の広さを直接指定することもできる。なお当然ながら、ノドと小口を両方指定したり、天と地を両方指定したりすることはできない。もし間違えて両方指定した場合はエラーが出るようにしてある。

```LaTeX
% ノドと天の広さを指定
\usepackage[nodo=20mm, ten=15mm]{hanmen}
```

```LaTeX
% 小口と地の広さを指定
\usepackage[koguchi=20mm, chi=15mm]{hanmen}
```

　

文字サイズ単位にQではなくptを使う。

```LaTeX
\usepackage[pt]{hanmen}
% \usepackage[ptj]{hanmen} % Wordに合わせたptのサイズにするには ptj とすること。
```

　

このパッケージは新ドキュメントクラス（jsbook.cls、jsarticle.clsなど）で使うことを想定している。旧ドキュメントクラス（jarticle.cls、tbook.clsなど）で使う場合、jisfontzoomオプションを付けないと、文字サイズが正しく設定されない。

```LaTeX
\usepackage[jisfontzoom]{hanmen}
```

　

版面を一切いじらない。

```LaTeX
\usepackage[pass]{hanmen}
```

# 提供されるマクロ
## `\newhanmen`
`\newhanmen` というマクロが提供される。これは、本文中で、

```LaTeX
\newhanmen{Q=11.5,H=19,W=42,L=17}
```

などとすると、文書の途中から基本版面を再設定できるマクロである。上記のオプションはすべてここでも使うことができる。

　

なお、一度代入した値は、`\newhanmen` においてもそのまま保持される。したがって、

```LaTeX
\usepackage[Q=13, nodo=20mm]{hanmen}
\newhanmen{ten=20mm}
```

とした場合、`Q=13` や `nodo=20mm` といった値はリセットされず、そのまま使われる。それゆえ、

```LaTeX
\usepackage[Q=13, nodo=20mm]{hanmen}
\newhanmen{koguchi=20mm}
```

とするとエラーとなる（ノドと小口を両方同時に指定することはできないため）。このような場合、次のように明示的にノドの広さをリセットしてやる必要がある。

```LaTeX
\usepackage[Q=13, nodo=20mm]{hanmen}
\newhanmen{nodo=\relax, koguchi=20mm}
```

## `\hanmenchangedir`
本文領域はそのままに、組方向だけ変えたい場合に使えるのが `\hanmenchangedir` である。本文中、このマクロを記述すると組方向だけが切り替わる。


## `\pagegridon`
`\usepackage[g=50]{hanmen}` とやる代わりに、`\pagegridon{g=50}` としてもグリッド線を表示できる。また、

```LaTeX
\pagegridon{g=26, column=2, columnskip=28.5}
```

とすると、26字×2段組の場合にもうまくグリッド線が表示される。columnskipは、一段の文字数＋段間の広さ。この場合、一段が26字あり、段間の広さが2.5字分あるので、26+2.5=28.5なので、`columnskip=28.5` としてある（段間の広さをミリメートルで指定できるようにもしたかったが、技術力不足により実現していない）。

# 提供される機能
## 正確な単位の導入
`\bQ` および `\bbp` を導入した。これによって、和文文字に関して、より正確に文字サイズを設定できるようになった。

事情を知らない人には意味が分からないだろうが、LaTeXの文字サイズ単位に関しては複雑な事情があり、そのため上のように新たに単位を導入する必要に迫られるのである。詳しくは、吉永氏による[クラスファイルにおける文字サイズの設定](https://web.archive.org/web/20170502030317/http://www.h4.dion.ne.jp/~latexcat/column/column1.html)などを参照せよ。

## フォントサイズの再定義
hanmenパッケージで `\usepackage[Q=13]{hanmen}` のように文字サイズを変更した場合、それに伴って `\small` や `\huge` といったLaTeXに備わった文字サイズ変更マクロが再定義され、文字サイズや行送りサイズが、0.5刻みの数値となる（ただし、現時点では、`Q=10` から `Q=16` までしか再定義されない）。しかしこれは簡易的なものである。したがって、より組版にこだわる人は、一冊の本を作るごとに別途再定義したほうがよいであろう。

## `tate` オプション時の挙動
hanmenパッケージ読み込み時、`tate` オプションを与えると、自動的にPDFが右綴じになる。また、`\cleardoublepage` が奇数起こしとなるよう再定義される。


# おわりに
最近は、日本語で小説を書く時間よりも、TeX言語でパッケージを書く時間のほうが長くなってしまった。文藝部員としては憂うべき事態である。

追記：このパッケージを使ってくれている人がいることに近頃気がついた（[この方](https://note.mu/asagiripenguin/n/nbd5cbc19ff15)など）。ありがたいことである。
