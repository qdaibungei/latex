---
layout: post
title: hanmenパッケージ
aliases:
    - /2017/02/18/hanmen.html
date: 2017-02-18
tags: ["LaTeX", "LaTeXパッケージ"]
---


# はじめに
hanmenパッケージというLaTeXパッケージを作った。ダウンロードは以下からできる。

- <https://gist.github.com/qdaibungei/5f6986fa99fc9a7d86122a7a9417d64e>

hanmenパッケージとは、版面の設計[^1]を厳密に行うためのパッケージである。たとえば、38字×40行で文書を作りたい、といったときにhanmenパッケージは有用である。

[^1]: 「版面の設計」とは何かについては、詳しくは「[基本版面（レイアウト）の設計](http://t2publisher.xrea.jp/forme/layout.shtml)」（外部サイト）などを参照せよ。

従来、LaTeXでは版面の設計が煩雑であった[^3]。特に縦組みの場合、geometryパッケージが使えないので厄介である。そこで、縦組みでも版面設計がやりやすいようにと作ったのがhanmenパッケージである。

[^3]: 煩雑と言っても、原理を理解するのはそれほど難しいことではない。「[1ページ当たりの行数，文字数と周囲の余白を設定する](http://d.hatena.ne.jp/Rion778/20091002/1254482262)」（外部サイト）に書いてあるように設定すればよいだけではある。ただし記述量が多く、プリアンブルに気軽に置いておける感じではない。そこでパッケージ化する必要が出てくるわけである。なお、あべのり氏によって開発中（2017年2月18日現在）のクラスファイルである[jlreq.cls](https://github.com/abenori/jlreq)は、従来のクラスファイルより圧倒的に版面設計が行いやすいようになっているようだ。したがってこれを使うというのもよい手であろう。

基本的なアイディアはTomOne氏の『[よくわかるLaTeX小説](http://p-act.sakura.ne.jp/PARALLEL_ACT/LaTeX-Dojin/)』による。


# 使い方
## 基本
基本的な使い方は簡単である。プリアンブルに次のように書き込む。

```LaTeX
\usepackage[Q=15,H=24,W=38,L=40]{hanmen}
```

そうすると、

* 文字サイズ　15級
* 行送り　　　24歯
* 行長　　　　38字
* 行数　　　　40行

に設定できる。`Q` は文字サイズの単位「級」に、`H` は行送りの単位「歯」に、`W` はwidthに、`L` はlinesに由来している。

## 各種オプション
### `grid`
グリッド線を表示させる（`g`に代入する値は上の`W`で指定した文字数と同じか、または近い整数値を入れる）。

```LaTeX
\usepackage[g=38]{hanmen}
```

### `tate`
縦組みにする。

```LaTeX
\usepackage[tate]{hanmen}
```

### ヘッダ・フッタ
ヘッダ・フッタの位置の調整。

```LaTeX
\usepackage[headheight=13mm, headsep=1mm, footskip=3mm]{hanmen}
```

### 上下左右の余白調整
デフォルトでは、版面は左右中央に配置される。これを、少しだけ小口側に寄せたり、天側に寄せたりしたい場合、以下のようにする（このオプションは正直インターフェースが微妙なので現在私自身は使っていないが、古い文書も処理できるよう残しておいた）。

```LaTeX
\usepackage[ko=3truemm]{hanmen}%% 3mm小口寄せ
% \usepackage[te=4truemm]{hanmen}%% 4mm天寄せ
```

ノド、小口、天、地の広さを直接指定することもできる。なお当然ながら、ノドと小口を両方指定したり、天と地を両方指定したりすることはできない。もし間違えて両方指定した場合はエラーが出るようにしてある。

```LaTeX
% ノドと天の広さを指定
\usepackage[nodo=20mm, ten=15mm]{hanmen}
```

```LaTeX
% 小口と地の広さを指定
\usepackage[koguchi=20mm, chi=15mm]{hanmen}
```

また、ノド、小口、天、地の広さを直接指定するだけでなく、既存の値に加算することもできる（それぞれ、`addnodo`、`addkoguchi`、`addten`、`addchi`というオプションで指定できる。なおこれらオプションは同時に指定してもエラーは生じない）。

```LaTeX
% ノドと天の広さを指定した後、広さを足す
\usepackage[nodo=20mm, ten=15mm, addnodo=5mm, addten=1zw]{hanmen}% ノドは25mm、天は15mm+1zwで指定される
```

```LaTeX
% 小口と地の広さを指定した後、広さを足す
\usepackage[koguchi=20mm, chi=15mm, addkoguchi=-5mm, addchi=2mm]{hanmen}% 小口は15mm、地は17mmで指定される
```

### 文字サイズ単位
文字サイズ単位にQではなくptを使う。

```LaTeX
\usepackage[pt]{hanmen}
% \usepackage[ptj]{hanmen} % Wordに合わせたptのサイズにするには ptj とすること。
```

### `jisfontzoom`
このパッケージは新ドキュメントクラス（jsbook.cls、jsarticle.clsなど）で使うことを想定している。旧ドキュメントクラス（jarticle.cls、tbook.clsなど）で使う場合、jisfontzoomオプションを付けないと、文字サイズが正しく設定されない。

```LaTeX
\usepackage[jisfontzoom]{hanmen}
```

### `adjustfontsize`
hanmenパッケージのデフォルトの動作では、`\normalsize`しか再定義されない。`\small`なども文字サイズを変更するには次のオプションをつける。

```LaTeX
\usepackage[adjustfontsize]{hanmen}
```

### `develop`
開発用コマンドが使えるようになるオプション。開発用コマンドについては[下記](#開発用コマンド)参照。

```LaTeX
\usepackage[develop]{hanmen}
```

### `pass`
版面を一切いじらない。

```LaTeX
\usepackage[pass]{hanmen}
```


# 提供されるマクロ
## `\newhanmen`
`\newhanmen` というマクロが提供される。これは、本文中で、

```LaTeX
\newhanmen{Q=11.5,H=19,W=42,L=17}
```

などとすると、文書の途中から基本版面を再設定できるマクロである。上記のオプションはすべてここでも使うことができる。

　

なお、一度代入した値は、`\newhanmen`を実行するごとにリセットされる[^old]。例えば`\usepackage[Q=13, nodo=20mm]{hanmen}`とオプションつきでパッケージを読み込んでいた場合に、`\newhanmen`後もノドの広さを20mmに保ちたいなら、必ず`\newhanmen{Q=15, nodo=20mm}`のようにノドの広さをもう一度指定しなければならない。

[^old]: 旧バージョン（v0.7以前）では、`\usepackage[Q=13, nodo=20mm]{hanmen}`とした場合、`Q=13` や `nodo=20mm` といった値はリセットされず、そのまま使われたため、さらに続けて`\newhanmen{koguchi=20mm}`とするとエラーとなっていた（`nodo`と`koguchi`を同時に指定することはできないため）。しかしこの挙動は分かりづらいと思われたため、仕様を変更した。つまり`\newhanmen`したとき最初に指定した値は引き継がれずそのつどリセットされるようにした。なお、旧バージョンで作成した文書は現バージョンのhanmenパッケージでも処理できるので、後方互換性は維持されている。


## `\switchwritingdirection`
本文領域はそのままに、組方向だけ変えたい場合に使えるのが `\switchwritingdirection` である[^hanmenchangedir]。本文中、このコマンドを記述すると組方向だけが切り替わる。例えば、横書きのときこのコマンドを挿入すると、その箇所で`\clearpage`され、次ページから縦書きになる。

[^hanmenchangedir]: 旧バージョン（v0.7以前）ではこのコマンドは`\hanmenchangedir`という名称だったが、やや妙な命名だったと思い直し、命名し直した。ただし旧バージョン時に作成された文書にも対応できるよう、`\hanmenchangedir`というコマンドも`\switchwritingdirection`のコピーとして残してある。


## `\pagegridon`
`\usepackage[g=50]{hanmen}` とやる代わりに、`\pagegridon{g=50}` としてもグリッド線を表示できる。また、

```LaTeX
\pagegridon{g=26, column=2, columnskip=28.5}
```

とすると、26字×2段組の場合にもうまくグリッド線が表示される。columnskipは、一段の文字数＋段間の広さ。この場合、一段が26字あり、段間の広さが2.5字分あるので、26+2.5=28.5なので、`columnskip=28.5` としてある（段間の広さをミリメートルで指定できるようにもしたかったが、技術力不足により実現していない）。

## 開発用コマンド
開発用コマンドを使うには、パッケージを読み込む際に`develop`オプションをつけておくこと。

### `\showhanmen`
`\showhanmen`は、現在設定している版面設計の値を出力するコマンド。例えば、ノドの広さを指定したときに、小口の広さがいくらになっているか確認したい、というときこのコマンドは便利である。

### `\calchanmen`
自分で定義しておきながら、使い方を忘れた。例えば、本文ページとおまけページとで文字サイズや組方向を変えたいというときがあるが、おまけページを作るとき何字×何行にすれば本文ページと余白の広さが同じくらいになるかを計算してくれる、というコマンドだったはず……。

## `\clearevenpage`、`\clearoddpage`
`\clearevenpage`は偶数ページになるまで`\clearpage`するコマンド。`\clearoddpage`は奇数ページになるまで`\clearpage`するコマンド。既存のコマンドに`\cleardoublepage`があるが、このコマンドは縦書きのとき不便なので新たにコマンドを定義したわけである。


# 提供される機能
## 正確な単位の導入
`\bQ` および `\bbp` を導入した。これによって、和文文字に関して、より正確に文字サイズを設定できるようになった。

事情を知らない人には意味が分からないだろうが、LaTeXの文字サイズ単位に関しては複雑な事情があり、そのため上のように新たに単位を導入する必要に迫られるのである。詳しくは、吉永氏による[クラスファイルにおける文字サイズの設定](https://web.archive.org/web/20170502030317/http://www.h4.dion.ne.jp/~latexcat/column/column1.html)などを参照せよ。

## フォントサイズの再定義
hanmenパッケージで `\usepackage[Q=13]{hanmen}` のように文字サイズを変更した場合、それに伴って `\small` や `\huge` といったLaTeXに備わった文字サイズ変更マクロが再定義され、文字サイズや行送りサイズが、0.5刻みの数値となる（ただし、現時点では、`Q=10` から `Q=16` までしか再定義されない）。しかしこれは簡易的なものである。したがって、より組版にこだわる人は、一冊の本を作るごとに別途再定義したほうがよいであろう。

## `tate` オプション時の挙動
hanmenパッケージ読み込み時、`tate` オプションを与えると、自動的にPDFが右綴じになる。また、`\cleardoublepage` が奇数起こしとなるよう再定義される。


# おわりに
最近は、日本語で小説を書く時間よりも、TeX言語でパッケージを書く時間のほうが長くなってしまった。文藝部員としては憂うべき事態である。

追記：このパッケージを使ってくれている人がいることに近頃気がついた（[この方](https://note.mu/asagiripenguin/n/nbd5cbc19ff15)など）。ありがたいことである。


# パッケージ更新履歴
## 2017年2月18日
- 初版。

## 2018年1月18日
- 依存パッケージとして必須だったnombre_for_fancyhdr.styは、今回の変更により、必要なくなった。
- `W`オプションに非整数値を入れることができるようになった。これにより、段間を2.5文字分にするといった組版が可能となった。
- `W`オプションの挙動変更に伴い、グリッド線を表示するオプションの使いかたが変更された。これまでは`\newhanmen{grid}`と指定したが、今回から`\newhanmen{g=50}`というふうに指定する仕様とした。

## 2019年9月2日
- オプションを追加し、ユーザーインターフェースを改良した。これにより、`\usepackage[nodo=20mm]{hanmen}`といったふうにノドの広さを直接指定したりできるようになった。
- 他にも色々と改良した。

## 2020年5月15日
- ユーザーインターフェースをやや改良した。
- コマンドの名称を変更した（旧コマンドも残してある）。
- いくつか機能追加した（addnodoやdevelopなどのオプションを追加）。
- 逆に、削除した機能もある。`\fontsizeX`などのフォントサイズ変更用コマンドは使っていなかったので削除した。
- グリッド線の色を変更し、薄い緑色とした。
