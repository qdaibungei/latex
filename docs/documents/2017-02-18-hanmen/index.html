<!DOCTYPE html>
<html lang="ja">
    <head>
        
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-155017107-1"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());

            gtag('config', 'UA-155017107-1');
        </script>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
        <title>hanmenパッケージ｜文藝部LaTeX研究会</title>
        <link rel="stylesheet" href="https://qdaibungei.github.io/latex/css/reset.css" media="screen" title="no title" charset="utf-8">
        <link rel="stylesheet" href="https://qdaibungei.github.io/latex/css/style.css" media="screen" title="no title" charset="utf-8">
        <link rel="stylesheet" href="https://qdaibungei.github.io/latex/css/syntax.css" media="screen" title="no title" charset="utf-8">
        <link rel="icon" type="image/svg" href="https://qdaibungei.github.io/latex/assets/img/favicon.svg">
        <script type="text/javascript" async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script>
        <script type="text/x-mathjax-config"> MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ["\\(","\\)"]] } });</script>
        
    </head>
    <body>
        <header class="header">
            <div class="header-wrapper">
                <div class="logo">
                    <a href="https://qdaibungei.github.io/latex">文藝部L<span class="a">a</span>T<span class="e">e</span>X研究会</a>
                </div>

<nav class="global-nav">
    <ul>
        <li class="nav-item"><a href="https://qdaibungei.github.io/latex"><span class="material-icons-round">home</span> HOME</a></li>
        <li class="nav-item"><a href="https://qdaibungei.github.io/latex/about"><span class="material-icons-round">info</span> About</a></li>
        
    </ul>
</nav>
</div>
</header>
<div class="wrapper clearfix">
<main class="main">
    <div class="content">

<p class="title">
    hanmenパッケージ<br>
</p>
<h1 id="はじめに">はじめに</h1>
<p>hanmenパッケージというLaTeXパッケージを作った。ダウンロードは以下からできる。</p>
<ul>
<li><a href="https://gist.github.com/qdaibungei/5f6986fa99fc9a7d86122a7a9417d64e">https://gist.github.com/qdaibungei/5f6986fa99fc9a7d86122a7a9417d64e</a></li>
</ul>
<p>hanmenパッケージとは、版面の設計<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>を厳密に行うためのパッケージである。たとえば、38字×40行で文書を作りたい、といったときにhanmenパッケージは有用である。</p>
<p>従来、LaTeXでは版面の設計が煩雑であった。特に縦組みの場合、geometryパッケージが使えないので厄介である<sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup>。そこで、縦組みでも版面設計がやりやすいようにと作ったのがhanmenパッケージである。</p>
<h1 id="基本的な使い方">基本的な使い方</h1>
<p>基本的な使い方は簡単である。プリアンブルに次のように書き込む。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-LaTeX" data-lang="LaTeX"><span class="line"><span class="cl"><span class="k">\usepackage</span><span class="na">[Q=15,H=24,W=38,L=40]</span><span class="nb">{</span>hanmen<span class="nb">}</span>
</span></span></code></pre></div><p>そうすると、</p>
<ul>
<li>文字サイズ　15級</li>
<li>行送り　　　24歯</li>
<li>行長　　　　38字</li>
<li>行数　　　　40行</li>
</ul>
<p>に設定できる。<code>Q</code> は文字サイズの単位「級」に、<code>H</code> は行送りの単位「歯」に、<code>W</code> はwidthに、<code>L</code> はlinesに由来している。なお、デフォルトではQ=11.5、H=19、W=42、L=17に設定してある。</p>
<h1 id="各種オプション">各種オプション</h1>
<h2 id="g">g</h2>
<p>グリッド線を表示させる（<code>g</code>に代入する値は上の<code>W</code>で指定した文字数と同じか、または近い整数値を入れる）。これで原稿用紙のようなマス目を表示させることができる。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-LaTeX" data-lang="LaTeX"><span class="line"><span class="cl"><span class="k">\usepackage</span><span class="na">[g=38]</span><span class="nb">{</span>hanmen<span class="nb">}</span>
</span></span></code></pre></div><h2 id="tate">tate</h2>
<p>縦組みにする。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-LaTeX" data-lang="LaTeX"><span class="line"><span class="cl"><span class="k">\usepackage</span><span class="na">[tate]</span><span class="nb">{</span>hanmen<span class="nb">}</span>
</span></span></code></pre></div><h2 id="ヘッダフッタ">ヘッダ・フッタ</h2>
<p>ヘッダ・フッタの位置の調整。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-LaTeX" data-lang="LaTeX"><span class="line"><span class="cl"><span class="k">\usepackage</span><span class="na">[headheight=13mm, headsep=1mm, footskip=3mm]</span><span class="nb">{</span>hanmen<span class="nb">}</span>
</span></span></code></pre></div><h2 id="上下左右の余白調整">上下左右の余白調整</h2>
<p>デフォルトでは、版面は左右中央に配置される。</p>
<p>左右中央のいずれかに版面を寄せたい場合には、ノド、小口、天、地の広さを直接手動で指定することができる。なお当然ながら、ノドと小口を両方指定したり、天と地を両方指定したりすることはできない（基本的に、hanmenパッケージはベタ組するためのパッケージなので）。もし間違えて両方指定した場合はエラーが出るようにしてある。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-LaTeX" data-lang="LaTeX"><span class="line"><span class="cl"><span class="c">% ノドと天の広さを指定
</span></span></span><span class="line"><span class="cl"><span class="c"></span><span class="k">\usepackage</span><span class="na">[nodo=20mm, ten=15mm]</span><span class="nb">{</span>hanmen<span class="nb">}</span>
</span></span><span class="line"><span class="cl"><span class="c">% 小口と地の広さを指定
</span></span></span><span class="line"><span class="cl"><span class="c">% \usepackage[koguchi=20mm, chi=15mm]{hanmen}
</span></span></span></code></pre></div><p>また、ノド、小口、天、地の広さを直接指定するだけでなく、既存の値に加算することもできる（それぞれ、<code>addnodo</code>、<code>addkoguchi</code>、<code>addten</code>、<code>addchi</code>というオプションで指定できる。なおこれらオプションは同時に指定してもエラーは生じない）。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-LaTeX" data-lang="LaTeX"><span class="line"><span class="cl"><span class="c">% ノドと天の広さを指定した後、広さを足す
</span></span></span><span class="line"><span class="cl"><span class="c"></span><span class="k">\usepackage</span><span class="na">[nodo=20mm, ten=15mm, addnodo=5mm, addten=1zw]</span><span class="nb">{</span>hanmen<span class="nb">}</span><span class="c">% ノドは25mm、天は15mm+1zwで指定される
</span></span></span><span class="line"><span class="cl"><span class="c">% 小口と地の広さを指定した後、広さを足す
</span></span></span><span class="line"><span class="cl"><span class="c">% \usepackage[koguchi=20mm, chi=15mm, addkoguchi=-5mm, addchi=2mm]{hanmen}% 小口は15mm、地は17mmで指定される
</span></span></span></code></pre></div><p>なお、版面を少しだけ小口側に寄せたり、天側に寄せたりしたい場合、以下のようにする（このオプションは正直インターフェースが微妙なので現在私自身は使っていないが、古い文書も処理できるよう残しておいた。現在の仕様では、同じことをするのに<code>addkoguchi</code>などを使ったほうが分かりやすいであろう）。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-LaTeX" data-lang="LaTeX"><span class="line"><span class="cl"><span class="k">\usepackage</span><span class="na">[ko=3mm]</span><span class="nb">{</span>hanmen<span class="nb">}</span><span class="c">%% 3mm小口寄せ
</span></span></span><span class="line"><span class="cl"><span class="c">% \usepackage[te=4mm]{hanmen}%% 4mm天寄せ
</span></span></span><span class="line"><span class="cl"><span class="c">% \usepackage[addkoguchi=-3mm]{hanmen}%% `\usepackage[ko=3mm]{hanmen}`と同値。この指定方法のほうがユーザーインターフェースとして分かりやすいであろう。
</span></span></span></code></pre></div><h2 id="単位変更">単位変更</h2>
<p>文字サイズ単位・行送り単位にQやHではなくptを使う。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-LaTeX" data-lang="LaTeX"><span class="line"><span class="cl"><span class="k">\usepackage</span><span class="na">[Q=13, H=20, pt]</span><span class="nb">{</span>hanmen<span class="nb">}</span><span class="c">% 文字サイズが13pt、行送りが20ptになる。
</span></span></span><span class="line"><span class="cl"><span class="c">% \usepackage[Q=13, H=20, ptj]{hanmen} % Wordに合わせたptのサイズにするには ptj とすること。
</span></span></span></code></pre></div><h2 id="jisfontzoom">jisfontzoom</h2>
<p>このパッケージは新ドキュメントクラス（jsbook.cls、jsarticle.clsなど）で使うことを想定している。旧ドキュメントクラス（jarticle.cls、tbook.clsなど）で使う場合、jisfontzoomオプションを付けないと、文字サイズが正しく設定されない。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-LaTeX" data-lang="LaTeX"><span class="line"><span class="cl"><span class="k">\usepackage</span><span class="na">[jisfontzoom]</span><span class="nb">{</span>hanmen<span class="nb">}</span>
</span></span></code></pre></div><h2 id="adjustfontsize">adjustfontsize</h2>
<p>このオプションは<strong>廃止</strong>した。デフォルトで、このオプションはつねに有効となるような挙動になった。</p>
<p>もともとは次のようにしていた。</p>
<blockquote>
<p>hanmenパッケージのデフォルトの動作では、<code>\normalsize</code>しか再定義されない。<code>\small</code>なども文字サイズを変更するには次のオプションをつける。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-LaTeX" data-lang="LaTeX"><span class="line"><span class="cl"><span class="k">\usepackage</span><span class="na">[adjustfontsize]</span><span class="nb">{</span>hanmen<span class="nb">}</span>
</span></span></code></pre></div></blockquote>
<p>しかしフォントサイズを再定義したくないときというのがあまりないと思われたため、このオプションは廃止した。</p>
<h2 id="develop">develop</h2>
<p>開発用コマンドが使えるようになるオプション。開発用コマンドについては<a href="#showhanmencalchanmen">下記</a>参照。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-LaTeX" data-lang="LaTeX"><span class="line"><span class="cl"><span class="k">\usepackage</span><span class="na">[develop]</span><span class="nb">{</span>hanmen<span class="nb">}</span>
</span></span></code></pre></div><h2 id="pass">pass</h2>
<p>版面を一切いじらない。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-LaTeX" data-lang="LaTeX"><span class="line"><span class="cl"><span class="k">\usepackage</span><span class="na">[pass]</span><span class="nb">{</span>hanmen<span class="nb">}</span>
</span></span></code></pre></div><h1 id="提供されるコマンド">提供されるコマンド</h1>
<h2 id="newhanmen">\newhanmen</h2>
<p><code>\newhanmen</code> というコマンドが提供される。これは、本文中で、</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-LaTeX" data-lang="LaTeX"><span class="line"><span class="cl"><span class="k">\newhanmen</span><span class="nb">{</span>Q=11.5,H=19,W=42,L=17<span class="nb">}</span>
</span></span></code></pre></div><p>などとすると、文書の途中から基本版面を再設定できるコマンドである。上記のオプションはすべてここでも使うことができる。</p>
<p>なお、一度代入した値は、<code>\newhanmen</code>を実行するごとにリセットされる<sup id="fnref:3"><a href="#fn:3" class="footnote-ref" role="doc-noteref">3</a></sup>。例えば<code>\usepackage[Q=13, nodo=20mm]{hanmen}</code>とオプションつきでパッケージを読み込んでいた場合に、<code>\newhanmen</code>後もノドの広さを20mmに保ちたいなら、必ず<code>\newhanmen{Q=15, nodo=20mm}</code>のようにノドの広さをもう一度指定しなければならない。</p>
<h2 id="switchwritingdirection">\switchwritingdirection</h2>
<p>本文領域はそのままに、組方向だけ変えたい場合に使えるのが <code>\switchwritingdirection</code> である<sup id="fnref:4"><a href="#fn:4" class="footnote-ref" role="doc-noteref">4</a></sup>。本文中、このコマンドを記述すると組方向だけが切り替わる。例えば、横書きのときこのコマンドを挿入すると、その箇所で<code>\clearpage</code>され、次ページから縦書きになる。</p>
<h2 id="pagegridon">\pagegridon</h2>
<p><code>\usepackage[g=50]{hanmen}</code> とやる代わりに、<code>\pagegridon{g=50}</code> としてもグリッド線を表示できる。また、</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-LaTeX" data-lang="LaTeX"><span class="line"><span class="cl"><span class="k">\pagegridon</span><span class="nb">{</span>g=26, column=2, columnskip=28.5<span class="nb">}</span>
</span></span></code></pre></div><p>とすると、26字×2段組の場合にもうまくグリッド線が表示される。columnskipは、一段の文字数＋段間の広さ。この例だと、一段が26字あり、段間の広さが2.5字分あるとの想定で（26+2.5=28.5なので）<code>columnskip=28.5</code> としてある（段間の広さをミリメートルで指定できるようにもしたかったが、技術力不足により実現していない）。</p>
<h2 id="pagegridcolor">\pagegridcolor</h2>
<p>グリッド線の色を変更するコマンド。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-LaTeX" data-lang="LaTeX"><span class="line"><span class="cl"><span class="k">\pagegridcolor</span><span class="nb">{</span>HTML<span class="nb">}{</span>e5abbe<span class="nb">}</span>
</span></span><span class="line"><span class="cl"><span class="c">% \pagegridcolor{rgb}{0.8,0.85,1}% rgbやcmykでももちろん指定可能。
</span></span></span></code></pre></div><p>のように宣言すると、色を変えることができる。色の指定の仕方はxcolorパッケージの<code>\definecolor</code>と同様である。</p>
<h2 id="showhanmencalchanmen">\showhanmen、\calchanmen</h2>
<p><code>\showhanmen</code>は、現在設定している版面設計の値を出力するコマンド。例えば、ノドの広さを指定したときに、小口の広さがいくらになっているか確認したい、というときこのコマンドは便利である。</p>
<p><code>\calchanmen</code>は、版面をいくらで設定すればよいか計算してくれるコマンド。しかし自分で定義しておきながら、使い方を忘れた。例えば、本文ページとおまけページとで文字サイズや組方向を変えたいというときがあるが、おまけページを作るとき何字×何行にすれば本文ページと余白の広さが同じくらいになるかを計算してくれる、というコマンドだったはず……。</p>
<p>これらは<strong>開発用コマンド</strong>である。開発用コマンドを使うには、パッケージを読み込む際に<code>develop</code>オプションをつけておくこと（版面設計し終わったらこれらコマンドは基本的に不要なので、普段無駄にコマンドが定義されたり依存パッケージが増加したりするのを防ぐため、オプションをつける仕様とした）。</p>
<h2 id="clearevenpageclearoddpage">\clearevenpage、\clearoddpage</h2>
<p><code>\clearevenpage</code>は偶数ページになるまで<code>\clearpage</code>するコマンド。<code>\clearoddpage</code>は奇数ページになるまで<code>\clearpage</code>するコマンド。既存のコマンドに<code>\cleardoublepage</code>があるが、このコマンドは縦書きのとき不便なので新たにコマンドを定義したわけである。</p>
<h1 id="提供される機能">提供される機能</h1>
<h2 id="正確な単位の導入">正確な単位の導入</h2>
<p><code>\bQ</code> および <code>\bbp</code> を導入した。これによって、和文文字に関して、より正確に文字サイズを設定できるようになった。</p>
<p>事情を知らない人には意味が分からないだろうが、LaTeXの文字サイズ単位に関しては複雑な事情があり、そのため上のように新たに単位を導入する必要に迫られるのである。詳しくは、吉永氏による<a href="https://web.archive.org/web/20170502030317/http://www.h4.dion.ne.jp/~latexcat/column/column1.html">クラスファイルにおける文字サイズの設定</a>などを参照せよ。</p>
<h2 id="tateオプション時の自動調整">tateオプション時の自動調整</h2>
<p>hanmenパッケージ読み込み時、<code>tate</code> オプションを与えると、自動的にPDFが右綴じになる。また、<code>\cleardoublepage</code> が奇数起こしとなるよう再定義される。</p>
<h1 id="パッケージ更新履歴">パッケージ更新履歴</h1>
<h2 id="2017年2月18日">2017年2月18日</h2>
<ul>
<li>初版。</li>
</ul>
<h2 id="2018年1月18日">2018年1月18日</h2>
<ul>
<li>依存パッケージとして必須だったnombre_for_fancyhdr.styは、今回の変更により、必要なくなった。</li>
<li><code>W</code>オプションに非整数値を入れることができるようになった。これにより、段間を2.5文字分にするといった組版が可能となった。</li>
<li><code>W</code>オプションの挙動変更に伴い、グリッド線を表示するオプションの使いかたが変更された。これまでは<code>\newhanmen{grid}</code>と指定したが、今回から<code>\newhanmen{g=50}</code>というふうに指定する仕様とした。</li>
</ul>
<h2 id="2019年9月2日">2019年9月2日</h2>
<ul>
<li>オプションを追加し、ユーザーインターフェースを改良した。これにより、<code>\usepackage[nodo=20mm]{hanmen}</code>といったふうにノドの広さを直接指定したりできるようになった。</li>
<li>他にも色々と改良した。</li>
</ul>
<h2 id="2020年5月15日">2020年5月15日</h2>
<ul>
<li>ユーザーインターフェースをやや改良した。</li>
<li>コマンドの名称を変更した（旧コマンドも残してある）。</li>
<li>いくつか機能追加した（addnodoやdevelopなどのオプションを追加）。</li>
<li>逆に、削除した機能もある。<code>\fontsizeX</code>などのフォントサイズ変更用コマンドは使っていなかったので削除した。</li>
<li>グリッド線の色を変更し、薄い緑色とした。</li>
</ul>
<h2 id="2021年4月12日">2021年4月12日</h2>
<ul>
<li>細かなバグを修正。</li>
</ul>
<h2 id="2022年6月9日">2022年6月9日</h2>
<ul>
<li>adjustfontsizeオプションを廃止した。</li>
<li>LuaLaTeXに対応させた。</li>
<li><code>\pagegridcolor</code>コマンドを導入した。</li>
</ul>
<h1 id="既知の問題">既知の問題</h1>
<ul>
<li>otfパッケージのオプションで<code>scale=1</code>と指定するような場合に対応できていない。そもそもjlreq.cls同様、フォントスケールは自由に定義できるようにしたほうがよいかもしれない。</li>
</ul>
<h1 id="参考文献">参考文献</h1>
<ul>
<li>村上智一（TomOne）『<a href="http://p-act.sakura.ne.jp/PARALLEL_ACT/LaTeX-Dojin/">よくわかるLaTeX小説 All You Need Is LaTeX</a>』（PARALLEL ACT、2014年）。「<a href="https://qdaibungei.github.io/latex/documents/2016-05-28-hanmen-sekkei/">LaTeXにおける版面設計</a>」に書いたような版面設計の方法などについてこの本から学ばせていただきました。</li>
</ul>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p>「版面の設計」とは何かについては、詳しくは「<a href="http://t2publisher.xrea.jp/forme/layout.shtml">基本版面（レイアウト）の設計</a>」（外部サイト）などを参照せよ。&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2">
<p>ただしこの状況は、阿部紀行氏によって開発中の<a href="https://github.com/abenori/jlreq">jlreq.cls</a>の登場により変化しつつある。このクラスファイルは、従来のクラスファイルに比べて非常に柔軟であり、縦書きの場合でもごく容易に版面設計が行なえるようになっている。&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:3">
<p>旧バージョン（v0.7以前）では、<code>\usepackage[Q=13, nodo=20mm]{hanmen}</code>とした場合、<code>Q=13</code> や <code>nodo=20mm</code> といった値はリセットされず、そのまま使われたため、さらに続けて<code>\newhanmen{koguchi=20mm}</code>とするとエラーとなっていた（<code>nodo</code>と<code>koguchi</code>を同時に指定することはできないため）。しかしこの挙動は分かりづらいと思われたため、仕様を変更した。つまり<code>\newhanmen</code>したとき最初に指定した値は引き継がれずそのつどリセットされるようにした。&#160;<a href="#fnref:3" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:4">
<p>旧バージョン（v0.7以前）ではこのコマンドは<code>\hanmenchangedir</code>という名称だったが、やや妙な命名だったと思い直し、命名し直した。ただし旧バージョン時に作成された文書にも対応できるよう、<code>\hanmenchangedir</code>というコマンドも<code>\switchwritingdirection</code>のコピーとして残してある。&#160;<a href="#fnref:4" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>

<div class="showarticleinfo">
    <span class="material-icons-round">schedule</span> 2017年2月18日<br>
    
    <span class="material-icons-round">update</span> 2022年6月9日<br>
    
    <span class="material-icons-round">local_offer</span>   <code><a href="/tags/latex">#LaTeX</a></code>  <code><a href="/tags/latex%e3%83%91%e3%83%83%e3%82%b1%e3%83%bc%e3%82%b8">#LaTeXパッケージ</a></code> <br>
</div>
                    </div>
                </main>
            </div>
        <footer class="footer">
            <p class="copyright">
                ©2016–2022 <a href="https://qdaibungei.github.io/latex/about">文藝部L<span class="a">a</span>T<span class="e">e</span>X研究会</a>
            </p>
        </footer>
    </body>
</html>

